{% extends "base.html" %}

{% block content %}
<div class="wiki-container">
    <form action="/" method="post">
    <div class="search-options">
        <input type="text" name="query" value="{{ query }}" placeholder="Buscar..." >
        
        <select name="search_type">
            <option value="title" {% if search_type == 'title' %}selected{% endif %}>Título</option>
            <option value="content" {% if search_type == 'content' %}selected{% endif %}>Contenido</option>
            <option value="authors" {% if search_type == 'authors' %}selected{% endif %}>Autores</option>
        </select>
        
        <button type="submit">Buscar</button>
    </div>
</form>

 <!-- Botón para Agregar Entrada -->
    <div class="add-entry-section">
        <button class="add-entry-button" onclick="showAddEntryFormWithValidation()">+ Agregar Entrada</button>
    </div>

    <!-- Formulario de Agregar Entrada (inicialmente oculto) -->
    <div id="add-entry-form-container" class="add-entry-form-container hidden">
        <form id="add-entry-form" class="add-entry-form">
            <h2>Agregar Nueva Entrada</h2>
            
            <div class="form-group">
                <label for="entry-title">Título:</label>
                <input type="text" id="entry-title" name="entry-title" required>
            </div>

            <div class="form-group">
                <label for="entry-date">Fecha:</label>
                <input type="date" id="entry-date" name="entry-date" required>
            </div>

            <div class="form-group">
                <label for="entry-subject">Asunto:</label>
                <input type="text" id="entry-subject" name="entry-subject" required>
            </div>

            <div class="form-group">
                <label for="entry-problem">Descripción del Problema:</label>
                <textarea id="entry-problem" name="entry-problem" rows="4" required></textarea>
            </div>

            <div class="form-group">
                <label for="entry-solution">Solución:</label>
                <textarea id="entry-solution" name="entry-solution" rows="4" required></textarea>
            </div>

            <div class="form-group">
                <label for="entry-authors">Autores (separados por coma):</label>
                <input type="text" id="entry-authors" name="entry-authors" required>
            </div>

            <!-- New Image Upload Section -->
        <div class="upload-section">
            <h3>Subir Imágenes</h3>
            <div class="image-upload-container">
                <input 
                    type="file" 
                    id="image-upload" 
                    name="images" 
                    accept="image/jpeg,image/png,image/gif,image/webp" 
                    multiple 
                    class="image-upload-input"
                >
                <label for="image-upload" class="image-upload-label">
                    Seleccionar Imágenes
                </label>
            </div>
            <div id="image-preview-list" class="image-preview-list">
                <!-- Image previews will be dynamically added here -->
            </div>
        </div>

        <!-- New File Upload Section -->
        <div class="upload-section">
            <h3>Adjuntar Archivos</h3>
            <div class="file-upload-container">
                <input 
                    type="file" 
                    id="file-upload" 
                    name="files" 
                    accept=".pdf,.doc,.docx,.txt,.xlsx,.csv" 
                    multiple 
                    class="file-upload-input"
                >
                <label for="file-upload" class="file-upload-label">
                    Seleccionar Archivos
                </label>
            </div>
            <div id="file-list" class="file-list">
                <!-- File items will be dynamically added here -->
            </div>
</div>
            <div class="form-actions">
                <button type="button" class="cancel-button" onclick="hideAddEntryForm()">Cancelar</button>
                <button type="submit" class="submit-button">Enviar Entrada</button>
            </div>
        </form>
    </div>



    <div class="entries">
        {% if query %}
            <!-- Si hay una consulta de búsqueda, mostramos los resultados de búsqueda -->
            <h2>Resultados para: "{{ query }}"</h2>
            {% if entries %}
                
                <div class="entry-list">
                <p><strong>{{ entries|length }}</strong> resultado(s) encontrado(s).</p>
                    {% for entry in entries %}
                        <div class="entry" id="entry-{{ loop.index }}" data-content="{{ entry.content }}">
                            <div class="entry-summary">
                                <h3>{{ entry.title }}</h3>
                                <p>{{ entry.content[:300] }}...</p>
                                <small>Autores: {{ ', '.join(entry.authors) }}</small>
                                <button class="view-more" onclick="toggleEntry('entry-{{ loop.index }}')">Ver más</button>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p>No se encontraron resultados para la búsqueda.</p>
            {% endif %}
        {% else %}
            <!-- Si no hay búsqueda, mostramos todas las entradas -->
            <h2>Todas las Entradas</h2>
            <p><strong>{{ entries|length }}</strong> resultado(s) encontrado(s).</p>
            <div class="entry-list">
                {% for entry in entries %}
                    <div class="entry" id="entry-{{ loop.index }}" data-content="{{ entry.content }}">
                        <div class="entry-summary">
                            <h3>{{ entry.title }}</h3>
                            <p>{{ entry.content[:200] }}...</p>
                            <small>Autores: {{ ', '.join(entry.authors) }}</small>
                            <button class="view-more" onclick="toggleEntry('entry-{{ loop.index }}')">Ver más</button>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
        
    </div>

    <!-- Detalles de la entrada (inicialmente ocultos) -->
    <div id="entry-details-container" class="entry-details-container hidden">
        <button class="back-button" onclick="goBack()">&#8592; Regresar</button>
        <div id="entry-details-content"></div>
    </div>
    
</div>

{% endblock %}
